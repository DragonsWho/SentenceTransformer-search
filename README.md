# Проект: Система семантического поиска текстовых игр

## Описание
Проект представляет собой систему для автоматического сбора, обработки и поиска информации о текстовых играх. Основные этапы работы:
1. Сбор JSON файлов по ссылкам
2. Преобразование JSON в Markdown
3. Создание структурированных описаний игр
4. Построение базы данных для семантического поиска
5. Поиск по базе с использованием трансформеров

## Функции файлов

### Основные скрипты
  
- **app.py** - Веб-интерфейс на Flask для поиска и отображения результатов:
  - Обрабатывает GET и POST запросы
  - Использует search.py для выполнения семантического поиска
  - Отображает результаты через шаблон index.html

- **search.py** - Движок семантического поиска:
  - Использует модель BAAI/bge-large-en-v1.5 через Hugging Face API
  - Преобразует запросы в 1024-мерные эмбеддинги
  - Вычисляет косинусное сходство с базой данных
  - Возвращает топ-K результатов с оценкой сходства
  - Поддерживает нормализацию векторов для повышения точности

- **crawl.py** - Обработка ссылок и данных:
  - Загружает JSON данные по URL
  - Преобразует JSON в структурированный Markdown:
    - Извлекает заголовки и текст из объектов
    - Сохраняет результаты в markdown/ с именем проекта
    - Добавляет заголовок игры в начало файла
  - Обрабатывает ошибки и возвращает None при сбоях

- **controller.py** - Основной управляющий скрипт:
  - Оркестрирует весь процесс обработки:
    1. Чтение URL из links.txt
    2. Обработка через crawl.py
    3. Использование js_json_extractor.py и traffic_analyzer.py как резервных механизмов добычи текста из игры
    4. Генерация описаний через summarize.py
    5. Создание скриншотов через get_screenshoot_puppy.js
    6. Анализ визуального стиля через vision_query.py
    7. Логирование результатов в log.txt
  - Поддерживает нормализацию URL
  - Обрабатывает ошибки и ведет учет неудачных URL
  - Добавляет визуальные описания в файлы summary

- **process_md.py** - Создание базы данных:
  - Генерация эмбеддингов для текстов
  - Сохранение базы данных в search_data.json
  process_md.py supports two modes:
--init: Creates new database from all summaries
--update: Adds new entries from controller.py

- **summarize.py** - Создание описаний игр:
  - Отправка текста в LLM для сжатия
  - Генерация структурированных описаний
  - Сохранение результатов в summaries/

- **detect_repetition.py** - Анализ summaries:
  - Обнаружение повторяющихся последовательностей слов
  - Выявление галлюцинаций LLM

- **get_screenshoot_puppy.js** - Автоматизация браузера:
  - Создание скриншотов веб-страниц
  - Сохранение в форматах PNG и WebP
  - Сохранение результатов в screenshoots/

- **vision_query.py** - Анализ изображений:
  - Генерация описаний визуального стиля игр
  - Использование Gemini API
  - Добавление описаний в файлы summary

- **traffic_analyzer.py** - Анализ сетевого трафика:
  - Автоматическое обнаружение файлов данных игры
  - Анализ трафика при загрузке страницы
  - Захват и обработка JSON файлов
  - Резервный механизм для случаев сбоя crawl.py

### Вспомогательные файлы
- **links.txt** - Список URL для обработки
- **search_data.json** - База данных для поиска (эмбеддинги и метаданные)
- **templates/index.html** - Шаблон веб-интерфейса
- **api_status.log** - Лог статуса API

## Состояние проекта
- crawl.py: корректно обрабатывает ссылки
- summarize.py: успешно создает описания с помощью LLM
- process_md.py: корректно создает базу данных
- search.py: работает корректно, выполняет поиск
- Веб-интерфейс: полностью функционирует
  - Поддерживает семантический поиск
  - Отображает результаты с оценкой сходства
  - Обрабатывает ошибки поиска
  - Поддерживает форматирование результатов

## Запуск поисковика
1. Убедитесь, что все зависимости установлены
2. Сгенерируйте базу данных:
   ```bash
   python process_md.py
   ```
3. Запустите веб-сервер:
   ```bash
   python app.py
   ```
4. Откройте http://localhost:5000 в браузере
5. Введите поисковый запрос и просмотрите результаты

 


## Примечания
- Не открывать файл search_data.json - он слишком большой
- Файлы в папках markdown и summaries также не открывать из-за их размера
- База данных search_data.json содержит эмбеддинги и метаданные для поиска
